sudo: false
language: ruby
rvm:
  - 2.3.1
before_install: gem install bundler -v 1.12.5

# Travis CI clones repositories to a depth of 50 commits, which is only really
# useful if you are performing git operations.
# https://docs.travis-ci.com/user/customizing-the-build/#Git-Clone-Depth
git:
  depth: 3

# enable Bundler caching
# https://docs.travis-ci.com/user/languages/ruby#Caching-Bundler
cache: bundler

# Using the ability to customise the Travis build to check for 'focus' labels
# i.e. labels used when working on a spec but which we don't want appearing in
# the final commit to master
# Reworking of http://stackoverflow.com/a/30495279/6117745
# If grep returns 0 (match found), test 0 -eq 1 will return 1.
# If grep returns 1 (no match found), test 1 -eq 1 will return 0.
# If grep returns 2 (error), test 2 -eq 1 will return 1.
before_script: >-
  echo "Checking for use of 'focus' labels in specs" && grep -r --include="*_spec.rb" "focus: true" spec/; test $? -eq 1

# This section was added as per https://docs.travis-ci.com/user/code-climate/
# To protect our codeclimate stats rather than adding the Codeclimate API key for ea-area_lookup
# in the open we used this guide https://docs.travis-ci.com/user/encryption-keys/ to encryt the
# value. Essentially install travis gem, then run `travis encrypt <my_code_climate_api_key>`
addons:
  code_climate:
    repo_token:
      secure: "Fa+J+1mLtiQpg9BSwiuZ7Oi9azCMkRaydRkgZe5zN1qt0aMEOhq3bLeNvnmcB8X1024jKWHozweMxE4BZ3lbL2o+QGksg9Sc56j88cTbNr35gdtbFvR/EFbNO0Y8ncmDuovw0lLJa0IwZKQ7E5WexyWhdsQ5ksKPUKr2e5kr/uJKm6B74nffL+W7wP
GkTEzfFOYgTJcLzCtSeMuiZy5jnbPca9iiLM5fq0sDZ6RoUfrv8BXLtOAF5hSwKYzhtthNlDVFYGylDB3zmWnhTtqJkUR4+jjQep/SXvOktgYJPXXxK5XV2QnqRUWlpTuOVvnJQKgZAMXlZ9gdQJMWNtL81llBsp65D8ymD8+JyqDunX+WN2aZYbOkN4geKag2ZAB
gd5GSvj5ZnEXR+YdxkmPHdeFVmeV3AhlwsX4dtXUV2g6icRmBE1cE/Q+VvS1w4t8xoeiLX12oJSpVGoSAC9Mx1fMtkcjrRmposwS4LMqtIJkEMnbDAo3eCrT2rToFBb/sVgLkuxVuO/nLmfeGoYFVRL3Rhe7rEg5euVYSDFLB/S9FrhTgrmTpGoFNzAKmF/V3+wBf
MlNYWWRLGKnQuy8+UUMFjOXP5kWF+pkdK6fB8yz/Jn9wI5OY4bd03V1gcmOxNhaNFIxh6k2x0m4Da3rgIu4bQSXeMtJSKz/OvN8eRZs="

deploy:
  provider: rubygems
  api_key:
    secure: "mrNfo3ZlO4wtr7fp751jltjKZcWeFXLCxxVDHqJVnkdAKpDcbo99Phlq9+fh5Q/o8gIJ4jKQybvr/Zu5t8mrWYJKKLlsUi3UThJG5hOg64ynJKy3jqtU45uCGOc33oBhQAqHTfDI+DZxQTGs2TepoqdyxsSzki
s9TRj+qyeE2HSO+yz5Qyjwql6o5k9xP82uBFaQI0WKqKdTtdNFv5LZ3EZaRWtyM/jGsunaNAYscDOl3cYN1sXlq+wfCTRvjMGmcppdbsaczQNQdIkXBPZEkydO7FdnSwUFuwm30BP0OBks5myB7oHWbbe0p/YRsUbjLF0dVfn
AlSERSwhkpMOU1BpK4/vwPBoR8yzgfZG4UZAZQ6hCMtRj+2usKWcI4buryeD+iPDrkVX9FjziOC3OFSbMzo/ojYlkLjvvXuUcTAmWZr0V/VP1x7RAiHNA+Y7EqYRJFJcEE5Av7Yn+hgi8fUtLyiSDLOb4bGJ2fe9R3YeZQ1ge
pvnarjriXfNZul3K1tP21/oVeXwCRuOjPMxwUmEsPCCjdIu/44U5CvGRbaqJXAqYJm71u+Y96RfkjytRnLmAc13nIBiFCUqUyoab4GIsy9AZ4TzE9ROGwLTC3y05gMVlYVJk4GTtVCjJwqNB2LWRXo/PseWaDdRZYmnNTr5wI
kB5wbWRtEYUdIOb70c="
  gem: quke
  on:
    tags: true
    repo: EnvironmentAgency/quke
